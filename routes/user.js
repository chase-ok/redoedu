// Generated by CoffeeScript 1.6.3
var User, check, listEmails, putEmail, test;

User = require('../data/user').User;

check = require('validator').check;

test = function(req, res) {
  var testing;
  testing = new User({
    name: "Some Guy",
    email: "some.guy@gmail.com",
    joinDate: Date.now(),
    age: 22,
    category: "Student",
    location: "Needham, MA"
  });
  testing.save(function(err) {
    if (err) {
      return console.log(err);
    }
  });
  return res.send("Hey there");
};

putEmail = function(req, res) {
  var e, email, user;
  email = req.body.email;
  try {
    check(email).len(6, 64).isEmail();
  } catch (_error) {
    e = _error;
    res.json({
      success: false,
      error: e.message
    });
    return;
  }
  user = new User({
    email: email
  });
  user.save(function(err) {
    if (err) {
      return console.log("Couldn't save user: " + err);
    }
  });
  return res.json({
    success: true
  });
};

listEmails = function(req, res) {
  return User.find({}, function(err, users) {
    var user;
    if (err) {
      return res.json({
        success: false,
        error: "" + err
      });
    } else {
      return res.json({
        success: true,
        emails: (function() {
          var _i, _len, _results;
          _results = [];
          for (_i = 0, _len = users.length; _i < _len; _i++) {
            user = users[_i];
            _results.push(user.email);
          }
          return _results;
        })()
      });
    }
  });
};

exports.create = function(app) {
  app.put('/user/email', putEmail);
  app.put('/user/email?', putEmail);
  app.get('/user/email/all', listEmails);
  return app.get('/user/test', test);
};
